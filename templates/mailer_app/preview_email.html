{% extends "mailer_app/base.html" %} {% block title %}Preview: {{ template.name }} - Bulk Emailer{% endblock %}

{% block page_title %}Preview: {{ template.name }}{% endblock %}

{% block content %}
<div class="card mb-6"> <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center">
        <div class="mb-4 sm:mb-0">
            <h2 class="text-xl font-semibold text-indigo-700">Template: {{ template.name }}</h2>
            <p class="text-sm text-gray-600"><strong>Subject:</strong> {{ rendered_subject }}</p>
        </div>
        <div class="flex space-x-2">
            <a href="{% url 'mailer_app:edit_email_template' template.id %}" class="btn-secondary text-sm">Edit Template</a>
            <a href="{% url 'mailer_app:manage_email_templates' %}" class="btn-secondary text-sm">Back to Templates</a>
        </div>
    </div>
    <p class="mt-3 text-xs text-gray-500">
        This is a preview using sample data. Merge tags like <code>{{first_name}}</code>, <code>{{last_name}}</code>, <code>{{email}}</code>, <code>{{unsubscribe_url}}</code>, and any custom fields (e.g., <code>{{company_name}}</code>) are replaced with placeholder values. The actual content will vary for each recipient based on their data.
    </p>
</div>

<div class="card"> <h3 class="text-lg font-medium text-gray-800 mb-4">Email Content Preview</h3>
    <div class="border border-gray-300 rounded-md shadow-sm overflow-hidden">
        <iframe id="emailPreviewFrame" src="{% url 'mailer_app:get_rendered_email_content' template.id %}" width="100%" height="600px" class="border-0"></iframe>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const iframe = document.getElementById('emailPreviewFrame');
    // Optional: iframe height adjustment (can be tricky)
    // iframe.onload = function() {
    //     try {
    //         iframe.style.height = iframe.contentWindow.document.body.scrollHeight + 'px';
    //     } catch (e) {
    //         console.warn("Could not resize iframe, possibly due to cross-origin restrictions if content is complex.");
    //     }
    // }
});
</script>
{% endblock %}
